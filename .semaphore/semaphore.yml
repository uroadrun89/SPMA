version: v1.0
name: ''
agent:
  machine:
    type: e1-standard-2
    os_image: ubuntu2004
blocks:
  - name: Set Up Environment
    task:
      jobs:
        - name: Set Up Python Environment
          commands:
            - apt update && apt upgrade -yuf
            - sudo apt-get install -y libsqlite3-dev
            - sudo apt-get install git
            - sudo apt install curl
            - sudo apt install -y nodejs vim
            - 'curl -sL https://dl.yarnpkg.com/debian/pubkey.gpg | gpg --dearmor | sudo tee /usr/share/keyrings/yarnkey.gpg >/dev/null'
            - 'echo "deb [signed-by=/usr/share/keyrings/yarnkey.gpg] https://dl.yarnpkg.com/debian stable main" | sudo tee /etc/apt/sources.list.d/yarn.list'
            - sudo apt update && sudo apt install yarn
            - sudo apt install build-essential zlib1g-dev libncurses5-dev libgdbm-dev libnss3-dev libssl-dev libreadline-dev libffi-dev libsqlite3-dev wget libbz2-dev
            - 'wget https://www.python.org/ftp/python/3.11.5/Python-3.11.5.tgz'
            - tar -xf Python-3.11.5.tgz
            - Python-3.11.5
            - apt-get install -y pkg-config
            - ./configure --enable-optimizations
            - make -j 8
            - sudo make altinstall
            - python3.11 -m pip install --upgrade pip
            - custom_dns4='1.1.1.1 8.8.8.8'
            - 'sed -i "/\[Resolve\]/a DNS=$custom_dns4" /etc/systemd/resolved.conf'
            - 'echo -e "\nDNS=${custom_dns4}" >> /etc/systemd/resolved.conf'
            - systemctl restart systemd-resolved
            - 'curl -s https://gitlab.com/rwkgyg/CFwarp/raw/main/CFwarp.sh -o /tmp/CFwarp.sh \'
            - '    && echo -e "3\n1\n3" > /tmp/input.txt \'
            - '    && bash /tmp/CFwarp.sh < /tmp/input.txt'
            - 'git clone https://github.com/uroadrun89/SPMA.git'
            - cd SP
            - cd SPMA
            - pip3.11 install -r requirements.txt
            - python3.11 main.py -y
