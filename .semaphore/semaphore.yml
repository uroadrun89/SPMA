version: v1.0
name: Telegram Bot CI Pipeline
agent:
  machine:
    type: e1-standard-2
    os_image: ubuntu2004
blocks:
  - name: Build Docker Image
    task:
      jobs:
        - name: Build Image
          commands:
            - checkout
            - docker build -t telegram-bot .
            - docker save -o telegram-bot.tar telegram-bot
            - mkdir -p /workspace/artifacts
            - mv telegram-bot.tar /workspace/artifacts/
  - name: Run Docker Container
    task:
      jobs:
        - name: Load and Run Container
          commands:
            - checkout
            - docker load -i /workspace/artifacts/telegram-bot.tar
            - docker run --rm -d --name telegram-bot-container telegram-bot
  - name: Cleanup
    task:
      jobs:
        - name: Stop and Remove Container
          commands:
            - docker stop telegram-bot-container || true
