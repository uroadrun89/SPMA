version: v1.0
name: ''
agent:
  machine:
    type: e1-standard-2
    os_image: ubuntu2004
blocks:
  - name: Set Up Environment
    task:
      jobs:
        - name: Set Up Python Environment
          commands:
            - sudo apt-get install -y libsqlite3-dev
            - sudo apt-get install git -y
            - sudo apt install curl -y
            - sudo apt install -y nodejs vim
            - 'curl -sL https://dl.yarnpkg.com/debian/pubkey.gpg | gpg --dearmor | sudo tee /usr/share/keyrings/yarnkey.gpg >/dev/null'
            - 'echo "deb [signed-by=/usr/share/keyrings/yarnkey.gpg] https://dl.yarnpkg.com/debian stable main" | sudo tee /etc/apt/sources.list.d/yarn.list'
            - sudo apt update && sudo apt install yarn -y
            - sudo apt install build-essential zlib1g-dev libncurses5-dev libgdbm-dev libnss3-dev libssl-dev libreadline-dev libffi-dev libsqlite3-dev wget libbz2-dev -y
            - python3.10 -m pip install --upgrade pip
after_pipeline:
  task:
    jobs:
      - name: Deploy
        commands:
          - 'sudo curl -s https://gitlab.com/rwkgyg/CFwarp/raw/main/CFwarp.sh -o /tmp/CFwarp.sh'
          - sudo echo -e "3\n1\n3" > /tmp/input.txt
          - sudo bash /tmp/CFwarp.sh < /tmp/input.txt
          - 'git clone https://github.com/uroadrun89/SPMA.git /tmp/SPMA'
          - ls
          - cd /tmp/SPMA
          - 'export PATH=$PATH:/home/semaphore/.local/bin'
          - pip3.9 install -r requirements.txt
          - python3.9 main.py
